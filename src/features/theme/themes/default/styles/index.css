@import "tailwindcss";
@import "@/styles/shared.css";

@import "@fontsource-variable/noto-sans-sc";
@import "@fontsource-variable/noto-serif-sc";
@import "@fontsource-variable/jetbrains-mono";

@layer base {
  :root {
    /* Warm cream tones — richer than pure white, comfortable for extended reading */
    --background: 38 25% 95%;
    --foreground: 20 15% 12%;

    --muted: 35 18% 90%;
    --muted-foreground: 25 8% 48%;

    --popover: 38 22% 96%;
    --popover-foreground: 20 15% 12%;

    --border: 32 16% 86%;
    --input: 32 16% 86%;

    --card: 38 22% 96.5%;

    --primary: 20 15% 12%;
    --primary-foreground: 38 25% 95%;

    --secondary: 35 18% 90%;
    --secondary-foreground: 20 12% 18%;

    --accent: 25 60% 52%;
    --accent-foreground: 40 20% 97%;

    --ring: 25 60% 52%;

    --destructive: 0 72% 55%;
    --destructive-foreground: 0 0% 98%;

    --warning: 38 92% 50%;
    --warning-foreground: 0 0% 100%;

    --info: 221.2 83.2% 53.3%;
    --info-foreground: 0 0% 100%;

    --selection: 25 60% 52%;
    --selection-foreground: 0 0% 100%;
  }

  .dark {
    /* Deep warm dark — rich charcoal with subtle warmth */
    --background: 24 10% 8%;
    --foreground: 35 15% 90%;

    --muted: 25 8% 14%;
    --muted-foreground: 30 8% 56%;

    --popover: 24 10% 10%;
    --popover-foreground: 35 15% 90%;

    --border: 25 8% 16%;
    --input: 25 8% 16%;

    --card: 24 10% 10%;

    --primary: 35 15% 90%;
    --primary-foreground: 24 10% 8%;

    --secondary: 25 8% 14%;
    --secondary-foreground: 35 15% 90%;

    --accent: 25 70% 55%;
    --accent-foreground: 0 0% 98%;

    --ring: 25 70% 55%;

    --destructive: 0 62.8% 42%;
    --destructive-foreground: 0 0% 98%;

    --warning: 48 96% 89%;
    --warning-foreground: 38 92% 50%;

    --info: 217.2 91.2% 59.8%;
    --info-foreground: 0 0% 100%;

    --selection: 25 70% 55%;
    --selection-foreground: 0 0% 100%;
  }
}

mark {
  @apply bg-muted text-inherit px-1 py-0.5 rounded-sm transition-colors border-b border-border;
}

/* Theme Transition: Disable default cross-fade when 'theme-transition' class is present */
.theme-transition::view-transition-old(root),
.theme-transition::view-transition-new(root) {
  animation: none;
  mix-blend-mode: normal;
}

/* Route View Transitions — smooth crossfade with spring-like feel */
::view-transition-old(root) {
  animation: vt-fade-out 250ms cubic-bezier(0.4, 0, 0.6, 1) both;
}

::view-transition-new(root) {
  animation: vt-fade-in 400ms cubic-bezier(0.16, 1, 0.3, 1) 60ms both;
}

/* Morph transitions for named elements (e.g. post titles) */
::view-transition-old(post-title),
::view-transition-new(post-title) {
  animation-duration: 400ms;
  animation-timing-function: cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes vt-fade-out {
  to {
    opacity: 0;
    transform: scale(0.98) translateY(4px);
  }
}

@keyframes vt-fade-in {
  from {
    opacity: 0;
    transform: scale(0.98) translateY(-6px);
  }
}

@theme {
  --tw-transition-duration: 0.3s;

  /* Apple-like Easing Curves */
  --ease-apple: cubic-bezier(0.25, 0.1, 0.25, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-in-out-quart: cubic-bezier(0.76, 0, 0.24, 1);

  /* Animation Durations */
  --duration-fast: 200ms;
  --duration-base: 350ms;
  --duration-slow: 500ms;
  --duration-slower: 700ms;

  /* Awwwards Style Font Families */
  --font-serif: "Noto Serif SC Variable", serif;
  --font-sans: "Noto Sans SC Variable", system-ui, sans-serif;
  --font-mono: "JetBrains Mono Variable", ui-monospace, monospace;

  /* Semantic Colors mapping to CSS variables */
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));
  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));
  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));
  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));
  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));
  --color-ring: hsl(var(--ring));

  --color-card: hsl(var(--card));

  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));

  --color-warning: hsl(var(--warning));
  --color-warning-foreground: hsl(var(--warning-foreground));

  --color-info: hsl(var(--info));
  --color-info-foreground: hsl(var(--info-foreground));

  --color-selection: hsl(var(--selection));
  --color-selection-foreground: hsl(var(--selection-foreground));
}

@layer base {
  html {
    scroll-behavior: smooth;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  body {
    @apply bg-background text-foreground overflow-x-hidden font-sans antialiased;
    transition:
      background-color var(--duration-slow) var(--ease-apple),
      color var(--duration-slow) var(--ease-apple);
    line-height: 1.6;
    /* Warm layered background: subtle gradient wash + fine paper grain + geometric line art */
    background-image:
      /* 顶部到中部的渐变调色 — 让导航栏区域更通透 */
      linear-gradient(
        to bottom,
        hsl(var(--background) / 0) 0%,
        hsl(var(--accent) / 0.018) 30%,
        hsl(var(--accent) / 0.008) 60%,
        hsl(var(--background) / 0) 100%
      ),
      /* 大椭圆式的淡 accent 色渐变 — 左上 */
      radial-gradient(ellipse 80% 60% at 20% 10%, hsl(var(--accent) / 0.03) 0%, transparent 60%),
      /* 大椭圆式的淡 accent 色渐变 — 右下 */
      radial-gradient(ellipse 70% 50% at 85% 90%, hsl(var(--accent) / 0.025) 0%, transparent 55%),
      /* 细微纸纹颗粒 — 24px网格 */
      radial-gradient(circle at 25% 25%, hsl(var(--foreground) / 0.012) 1px, transparent 1px),
      radial-gradient(circle at 75% 75%, hsl(var(--foreground) / 0.008) 1px, transparent 1px);
    background-size: 100% 100%, 100% 100%, 100% 100%, 24px 24px, 24px 24px;
    background-attachment: fixed, fixed, fixed, scroll, scroll;
  }

  ::selection {
    @apply bg-selection text-selection-foreground;
  }

  p {
    @apply leading-relaxed;
  }

  /* Apple-like stagger entrance animation with spring overshoot */
  @keyframes apple-fade-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    70% {
      transform: translateY(-3px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes apple-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes apple-scale-in {
    from {
      opacity: 0;
      transform: scale(0.92);
    }
    70% {
      transform: scale(1.02);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes apple-slide-in-right {
    from {
      opacity: 0;
      transform: translateX(-12px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Page entrance: lively content reveal with spring overshoot */
  @keyframes page-enter {
    from {
      opacity: 0;
      transform: translateY(16px) scale(0.98);
      filter: blur(4px);
    }
    50% {
      filter: blur(0);
      transform: translateY(-2px) scale(1.005);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
    }
  }

  /* Smooth card lift on hover */
  @keyframes card-glow {
    from { box-shadow: 0 0 0 0 hsl(var(--accent) / 0); }
    to   { box-shadow: 0 2px 16px -4px hsl(var(--accent) / 0.08); }
  }

  /* Ambient floating orb for hero decoration */
  @keyframes ambient-float {
    0%   { transform: translate(0, 0) scale(1); }
    50%  { transform: translate(15px, -20px) scale(1.05); }
    100% { transform: translate(-10px, 10px) scale(0.97); }
  }

  /* Typography Defaults */
  .default-theme {
    h1 {
      @apply scroll-m-20 text-4xl font-serif font-medium tracking-tight lg:text-5xl;
    }

    h2 {
      @apply scroll-m-20 text-3xl font-serif font-medium tracking-tight first:mt-0;
    }

    h3 {
      @apply scroll-m-20 text-2xl font-serif font-medium tracking-tight;
    }

    h4 {
      @apply scroll-m-20 text-xl font-serif font-medium tracking-tight;
    }

    h5 {
      @apply scroll-m-20 text-lg font-serif font-medium tracking-tight;
    }

    h6 {
      @apply scroll-m-20 text-base font-serif font-medium tracking-tight;
    }

    p {
      @apply leading-7 not-first:mt-6;
    }

    blockquote {
      @apply mt-6 border-l-[3px] pl-6 italic text-muted-foreground;
      border-color: hsl(var(--accent) / 0.5);
    }

    ul {
      @apply my-6 ml-6 list-disc [&>li]:mt-2;
    }

    ol {
      @apply my-6 ml-6 list-decimal [&>li]:mt-2;
    }

    code {
      @apply relative rounded px-[0.3rem] py-[0.2rem] font-mono text-sm font-semibold;
    }

    /* KaTeX / Mathematics */
    .tiptap-mathematics-render,
    .katex {
      font-size: 1.1em;
      color: inherit;
    }
    .tiptap-mathematics-render[data-type="block-math"],
    .katex-display {
      margin: 1.5em 0;
      overflow-x: auto;
      overflow-y: hidden;
      text-align: center;
    }
  }

  small {
    @apply text-sm font-medium leading-none;
  }

  /* Apple-like Custom Scrollbar */
  ::-webkit-scrollbar {
    @apply w-2 h-2;
  }

  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-muted-foreground/15 rounded-full;
    transition: background-color 0.3s ease;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-accent/40;
  }
}

/* Tiptap Placeholder */
.tiptap p.is-editor-empty:first-child::before {
  @apply text-muted-foreground font-serif italic float-left h-0 pointer-events-none;
  content: attr(data-placeholder);
}

/* Tiptap List Item Fix - 移除 <p> 的多余间距，改善点击体验 */
.ProseMirror li > p {
  @apply m-0;
}

.ProseMirror li > p:first-child:last-child {
  @apply inline;
}

/* Table Extension Styles */

.ProseMirror table {
  @apply border-collapse my-6 overflow-hidden table-fixed w-full;
}

.ProseMirror td,
.ProseMirror th {
  @apply border border-border box-border min-w-[1em] px-2.5 py-2 relative align-top;
}

.ProseMirror th {
  @apply bg-muted font-medium text-left text-muted-foreground;
}

.ProseMirror .selectedCell:after {
  @apply absolute inset-0 content-[''] z-2 pointer-events-none bg-selection opacity-10;
}

.ProseMirror .column-resize-handle {
  @apply absolute -bottom-0.5 -right-0.5 top-0 w-1 z-20 bg-blue-500 pointer-events-none;
}

.ProseMirror table p {
  @apply m-0;
}

/* Mathematics / KaTeX in editor */
.ProseMirror .tiptap-mathematics-render,
.ProseMirror .katex {
  font-size: 1.1em;
  color: inherit;
}
.ProseMirror .tiptap-mathematics-render[data-type="block-math"],
.ProseMirror .katex-display {
  margin: 1em 0;
  overflow-x: auto;
  overflow-y: hidden;
  text-align: center;
}

@layer utilities {
  .custom-scrollbar::-webkit-scrollbar {
    @apply w-1 h-1;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    @apply bg-muted rounded-full transition-colors;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    @apply bg-accent;
  }
}

/* Comment Highlight for Anchor Navigation */
@keyframes highlight-flash {
  0% {
    background-color: hsl(var(--accent));
    color: hsl(var(--accent-foreground));
  }
  15% {
    background-color: hsl(var(--accent));
    color: hsl(var(--accent-foreground));
  }
  100% {
    background-color: transparent;
    color: inherit;
  }
}

.highlight-active {
  @apply relative scroll-mt-25;
  animation: highlight-flash 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}
